fan_toilet1_control:

  #######################################################################
  # üîò –§–õ–ê–ì –ü–ê–£–ó–´ –ê–í–¢–û–ú–ê–¢–ò–ö–ò (—É–≤–∞–∂–∞—Ç—å —Ä—É—á–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ)
  #######################################################################
  input_boolean:
    toilet1_fan_pause:
      name: "–ü–∞—É–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ ‚Äî –°–∞–Ω—É–∑–µ–ª 1"
      icon: mdi:pause-circle

  #######################################################################
  # üïí –¢–ê–ô–ú–ï–† –†–£–ß–ù–û–ô –í–ï–ù–¢–ò–õ–Ø–¶–ò–ò (45 –º–∏–Ω)
  #######################################################################
  timer:
    toilet1_fan_timer:
      name: –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –≤ —Å–∞–Ω—É–∑–ª–µ 1 –æ—Ç–∫–ª—é—á–∏—Ç—Å—è —á–µ—Ä–µ–∑
      duration: "00:45:00"

  #######################################################################
  # ‚öôÔ∏è  –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–ò
  #######################################################################
  automation:

    ###################################################################
    # 1) –ê–≤—Ç–æ–≤–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ (>75%), –µ—Å–ª–∏ –Ω–µ—Ç –ø–∞—É–∑—ã
    ###################################################################
    - id: a_toilet1_fan_auto_on
      alias: "–ê–≤—Ç–æ: –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ (–≤–ª–∞–∂–Ω–æ—Å—Ç—å >75%) ‚Äî –°/–£ 1"
      initial_state: true
      mode: restart
      trigger:
        - platform: numeric_state
          entity_id: sensor.sanuzel1_humidity
          above: 75
          for: "00:01:00"
      condition:
        - condition: state
          entity_id: fan.sanuzel_1
          state: "off"
        - condition: state
          entity_id: input_boolean.toilet1_fan_pause
          state: "off"
      action:
        - service: fan.turn_on
          target:
            entity_id: fan.sanuzel_1
        # –µ—Å–ª–∏ —à—ë–ª —Ä—É—á–Ω–æ–π —Ç–∞–π–º–µ—Ä ‚Äî –æ—Ç–º–µ–Ω—è–µ–º, –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –≤–∑—è–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        - service: timer.cancel
          target:
            entity_id: timer.toilet1_fan_timer

    ###################################################################
    # 2) –ê–≤—Ç–æ–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (<60%)
    ###################################################################
    - id: a_toilet1_fan_auto_off
      alias: "–ê–≤—Ç–æ: –í–µ–Ω—Ç–∏–ª—è—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞ (–≤–ª–∞–∂–Ω–æ—Å—Ç—å <60%) ‚Äî –°/–£ 1"
      initial_state: true
      mode: restart
      trigger:
        - platform: numeric_state
          entity_id: sensor.sanuzel1_humidity
          below: 60
          for: "00:02:00"
      condition:
        - condition: state
          entity_id: fan.sanuzel_1
          state: "on"
      action:
        - service: fan.turn_off
          target:
            entity_id: fan.sanuzel_1

    ###################################################################
    # 3) –†—É—á–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ ‚Äî —Å—Ç–∞—Ä—Ç —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ 45 –º–∏–Ω
    ###################################################################
    - id: a_toilet1_fan_manual_on
      alias: "–†—É—á–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ (45 –º–∏–Ω) ‚Äî –°/–£ 1"
      initial_state: true
      mode: restart
      trigger:
        - platform: state
          entity_id: fan.sanuzel_1
          from: "off"
          to: "on"
      action:
        - service: timer.start
          target:
            entity_id: timer.toilet1_fan_timer
          data:
            duration: "00:45:00"

    ###################################################################
    # 4) –ê–≤—Ç–æ–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ä—É—á–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞
    ###################################################################
    - id: a_toilet1_fan_timer_off
      alias: "–¢–∞–π–º–µ—Ä –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ –∏—Å—Ç—ë–∫ ‚Äî –°/–£ 1"
      initial_state: true
      mode: restart
      trigger:
        - platform: event
          event_type: timer.finished
          event_data:
            entity_id: timer.toilet1_fan_timer
      condition:
        - condition: state
          entity_id: fan.sanuzel_1
          state: "on"
      action:
        - service: fan.turn_off
          target:
            entity_id: fan.sanuzel_1

    ###################################################################
    # 5) –ü–∞—É–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –Ω–∞ 15 –º–∏–Ω –ø—Ä–∏ –†–£–ß–ù–û–ú –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–ª–∞–∂–Ω–æ—Å—Ç–∏
    ###################################################################
    - id: a_toilet1_fan_pause_on
      alias: "–ü–∞—É–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ (—Ä—É—á–Ω–æ–µ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ >75%) ‚Äî –°/–£ 1"
      initial_state: true
      mode: restart
      trigger:
        - platform: state
          entity_id: fan.sanuzel_1
          from: "on"
          to: "off"
      condition:
        - condition: numeric_state
          entity_id: sensor.sanuzel1_humidity
          above: 75
      action:
        # –µ—Å–ª–∏ —à—ë–ª —Ä—É—á–Ω–æ–π —Ç–∞–π–º–µ—Ä ‚Äî –æ—Ç–º–µ–Ω—è–µ–º, —Ä–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∫–ª—é—á–∏–ª
        - service: timer.cancel
          target:
            entity_id: timer.toilet1_fan_timer
        # –≤–∫–ª—é—á–∞–µ–º –ø–∞—É–∑—É –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏
        - service: input_boolean.turn_on
          target:
            entity_id: input_boolean.toilet1_fan_pause
        # –ø–∞—É–∑–∞ 15 –º–∏–Ω—É—Ç, –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∫–µ —Å–Ω–æ–≤–∞ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–∏ >75%
        - delay: "00:15:00"
        - service: input_boolean.turn_off
          target:
            entity_id: input_boolean.toilet1_fan_pause
