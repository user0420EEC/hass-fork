# Автоматизации открытия и закрытия штор

#######################################################################
# 1️⃣ Открытие штор в 07:00 по будням, если они закрыты по сенсору
#######################################################################
- id: curtains_open_weekdays_0700
  alias: "Шторы: открыть в 07:00 (будни)"
  initial_state: true
  mode: parallel
  trigger:
    - platform: time
      at: "07:00:00"
  condition:
    - condition: time
      weekday: [mon, tue, wed, thu, fri]
  action:
    - choose:
        # Зал
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_zal_contact
              state: "off"     # off = закрыты → открыть
          sequence:
            - service: cover.open_cover
              target:
                entity_id: cover.zal_shtory

        # Кухня
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_kuhnya_contact
              state: "off"
          sequence:
            - service: cover.open_cover
              target:
                entity_id: cover.kuhnya_shtory

        # Детская
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_detskaya_contact
              state: "off"
          sequence:
            - service: cover.open_cover
              target:
                entity_id: cover.detskaya_shtory

        # Спальня
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_spalnya_contact
              state: "off"
          sequence:
            - service: cover.open_cover
              target:
                entity_id: cover.spalnya_shtory
      default: []

#######################################################################
# 2️⃣ Закрытие штор при наступлении ночи или при старте HA, если уже ночь
#######################################################################
- id: curtains_close_on_night
  alias: "Шторы: закрыть при наступлении темноты"
  initial_state: true
  mode: parallel
  trigger:
    - platform: state
      entity_id: binary_sensor.day_night
      from: "on"
      to: "off"        # on = день → off = ночь
    - platform: homeassistant
      event: start      # при старте тоже проверяем
  condition:
    - condition: state
      entity_id: binary_sensor.day_night
      state: "off"      # выполняем только если сейчас ночь
  action:
    - choose:
        # Зал
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_zal_contact
              state: "on"      # on = открыты → закрыть
          sequence:
            - service: cover.close_cover
              target:
                entity_id: cover.zal_shtory

        # Кухня
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_kuhnya_contact
              state: "on"
          sequence:
            - service: cover.close_cover
              target:
                entity_id: cover.kuhnya_shtory

        # Детская
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_detskaya_contact
              state: "on"
          sequence:
            - service: cover.close_cover
              target:
                entity_id: cover.detskaya_shtory

        # Спальня
        - conditions:
            - condition: state
              entity_id: binary_sensor.curtains_sensor_spalnya_contact
              state: "on"
          sequence:
            - service: cover.close_cover
              target:
                entity_id: cover.spalnya_shtory
      default: []
